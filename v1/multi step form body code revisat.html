<!-- Multi Step Form Custom Code -->
<script>
const stepsId = ['step1', 'step2', 'step3']; // PUT HERE ALL YOUR SLIDES (STEPS) ID'S BY ORDER
const next = $('#next');
const back = $('#back');
const msfMask = $('.msf-mask');
const msf = $('#msf');
const rightArrow = $('#right-arrow');
const leftArrow = $('#left-arrow');
let numberOfSteps = stepsId.length;
let stepsHeight = [];
let requiredInputs = [];
var Webflow = Webflow || [];

Webflow.push(function () {
	$.each(stepsId, function() {	// Finds all required inputs in each slide and stores them
		let itemId = document.getElementById(this);
		let itemHeight = $(itemId).css('height');
  		let inputsArray = [];
		$(itemId).find('input, select, textarea').filter('[required]:visible').each(function() {
			inputsArray.push(this.id);
		});
    	requiredInputs.push(inputsArray);
		stepsHeight.push(itemHeight);
	});
	$(msfMask).height(stepsHeight[0]);	// Sets height of mask to fit the 1st slide

	$(next).click(function(){
		let currentStep = parseInt($(this).attr('step'));
		let stepIndex = currentStep - 1;
		let filledInputs = 0;

		$.each(requiredInputs[stepIndex], function() {	// Checks if each required input of the step is filled and warns the user when not
			let itemId = document.getElementById(this);
			let itemValue = $(itemId).val();
			let itemConfirmId = document.getElementById(this+'-value');

			if ( !$(itemId).val() ) {
				$(itemId).addClass('warning');
			}
			else {
				$(itemId).removeClass('warning');
				$(itemConfirmId).html(itemValue);	// Sets the value of the input to the correspondant field in the confirm section
				filledInputs++;
			}
		});

		if (requiredInputs[stepIndex].length == filledInputs) {	// If all the required fields are filled, moves to the next step, and sets the slider height to fit the content
			if (currentStep == numberOfSteps) {	// If last step is detected, submits the form when clicking the button
				$(msf).submit();
			} else {
				$(msfMask).height(stepsHeight[currentStep]);
				currentStep++;
				$(this).attr('step', currentStep);
				$(rightArrow).trigger('tap');
				if (currentStep == numberOfSteps) { $(this).text("Submit"); }	// If last step is detected, modifies the button to act as Submit
			}
		} else {
			alert("Please, fill all the required fields.");
		}
	});

	$(back).click(function(){	// Moves to the previous step and sets the mask height to fit the content
		let currentStep = parseInt($(next).attr('step'));
		let previousStep = currentStep - 1;

		$(msfMask).height(stepsHeight[previousStep-1]);
		$(next).attr('step', previousStep);
		$(leftArrow).trigger('tap');
		$(next).text("Next");
	});
});
</script>